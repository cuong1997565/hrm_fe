{"remainingRequest":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/babel-loader/lib/index.js!/home/nguyenxuancuong/Sites/hrm_fe/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/nguyenxuancuong/Sites/hrm_fe/src/views/branch/Listting.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/nguyenxuancuong/Sites/hrm_fe/src/views/branch/Listting.vue","mtime":1542943180867},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/cache-loader/dist/cjs.js","mtime":1538403001796},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/@babel/runtime/helpers/builtin/es6/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapFields } from 'vuex-map-fields';\nimport { debounce, findIndex } from 'lodash';\nimport DialogConfirm from '@/components/DialogConfirm';\nimport DataView from '@/components/DataView/DataView';\nimport { mapActions, mapGetters } from 'vuex';\nexport default {\n  name: 'BranchListting',\n  components: {\n    DataView: DataView,\n    DialogConfirm: DialogConfirm\n  },\n  props: {\n    type: {\n      type: String,\n      default: 'index'\n    },\n    isMini: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data: function data() {\n    return {\n      branch: {\n        status: 1,\n        type: 1\n      },\n      districtActive: false,\n      dialogDelete: false,\n      item: {},\n      idBranch: null,\n      title: [{\n        text: 'Tên chi nhánh',\n        sortable: false\n      }, {\n        text: 'Email',\n        sortable: false\n      }, {\n        text: 'Mã sô thuế',\n        sortable: false\n      }, {\n        text: 'Địa chỉ',\n        sortable: false\n      }, {\n        text: 'Trạng thái',\n        sortable: false\n      }, {\n        text: 'Hành động',\n        sortable: false\n      }],\n      dataViewHeight: 0,\n      dataViewName: 'branch'\n    };\n  },\n  computed: _objectSpread({}, mapGetters('City', ['cityAll', 'districtByCity']), mapGetters('Branch', ['filterParams']), {\n    isIndex: function isIndex() {\n      return this.type === 'index';\n    },\n    isBranchMain: function isBranchMain() {\n      var array = this.$store.getters['Dataview/dataViews']('branch');\n      return array.data;\n    }\n  }, mapFields(\"Branch\", {\n    filterQ: 'params.q',\n    filterByCity: 'params.cityId',\n    filterByDistrict: 'params.districtId'\n  })),\n  methods: _objectSpread({}, mapActions(['setMiniDrawer']), mapActions('Dataview', ['removeDataviewEntry', 'updateDataviewEntry']), mapActions('Branch', ['getBranch', 'updateTypeBranch', 'deleteBranch', 'updateStatusBranch', 'clearFilter', 'clearFilterCity']), mapActions(['showNotify', 'setMiniDrawer']), mapActions('City', ['getCity', 'getDistrictByCity']), {\n    branchDetail: function branchDetail(branch) {\n      this.clearFilter();\n      this.filter();\n      this.getBranch({\n        branchId: branch.id\n      }); // this.clearFilter()\n\n      this.$router.push({\n        name: 'branch-detail',\n        params: {\n          id: branch.id\n        }\n      });\n    },\n    clearCity: function clearCity() {\n      this.clearFilterCity();\n    },\n    resetForm: function resetForm() {\n      this.clearFilter();\n    },\n    changeSearch: debounce(function () {\n      this.filter();\n    }, 500),\n    changedCity: debounce(function (value) {\n      var _this = this;\n\n      if (value) {\n        this.districtActive = true;\n        this.getDistrictByCity({\n          cityId: value,\n          cb: function cb() {\n            _this.districtAll = _this.districtByCity;\n          }\n        });\n      } else {\n        this.districtActive = false;\n      }\n\n      this.filter();\n    }, 500),\n    filter: function filter() {\n      this.$refs[this.dataViewName].$emit('reload');\n    },\n    updatedTypeBranch: function updatedTypeBranch(item) {\n      var _this2 = this;\n\n      this.updateTypeBranch({\n        id: item.id,\n        cb: function cb(response) {\n          _this2.$store.dispatch('showNotify', {\n            text: _this2.$t('alert.updateTypeBranchSuccess'),\n            color: 'success'\n          }); // tìm trong mảng vị trí index có kiểu chi nhánh chính\n\n\n          var index = findIndex(_this2.isBranchMain, {\n            type: 1\n          });\n\n          if (index > -1) {\n            var object = Object.assign({}, _this2.isBranchMain[index]);\n            object.type = 0;\n\n            _this2.updateDataviewEntry({\n              name: 'branch',\n              data: object,\n              key: 'id'\n            });\n          }\n\n          _this2.updateDataviewEntry({\n            name: 'branch',\n            data: response.data,\n            key: 'id'\n          });\n        },\n        error: function error(_error) {\n          if (_error.status === 404) {\n            _this2.$store.dispatch('showNotify', {\n              text: _this2.$t('alert.not-found'),\n              color: 'warning'\n            });\n          }\n        }\n      });\n    },\n    changeStatus: function changeStatus(idBranch) {\n      var _this3 = this;\n\n      this.updateStatusBranch({\n        id: idBranch,\n        cb: function cb(response) {\n          _this3.$store.dispatch('showNotify', {\n            text: _this3.$t('alert.statusSuccess'),\n            color: 'success'\n          });\n        },\n        error: function error(_error2) {\n          if (_error2.status === 404) {\n            _this3.$store.dispatch('showNotify', {\n              text: _this3.$t('alert.not-found'),\n              color: 'warning'\n            });\n          }\n        }\n      });\n    },\n    removeConfirm: function removeConfirm(item) {\n      this.branch = item;\n      this.idBranch = item.id;\n      this.dialogDelete = true;\n    },\n    remove: function remove(confirm) {\n      var _this4 = this;\n\n      if (confirm) {\n        this.deleteBranch({\n          id: this.idBranch,\n          cb: function cb(response) {\n            _this4.$store.dispatch('showNotify', {\n              text: _this4.$t('alert.deleteBranchSuccess'),\n              color: 'success'\n            });\n\n            _this4.removeDataviewEntry({\n              name: 'branch',\n              data: _this4.branch,\n              key: 'id'\n            });\n\n            _this4.dialogDelete = false;\n          },\n          error: function error(_error3) {\n            if (_error3.status === 404) {\n              _this4.$store.dispatch('showNotify', {\n                text: _this4.$t('alert.not-found'),\n                color: 'warning'\n              });\n            }\n          }\n        });\n      }\n    }\n  }),\n  mounted: function mounted() {\n    var _this5 = this;\n\n    if (this.$route.params.id) {\n      this.dataViewHeight = this.$refs.laylout.clientHeight - 48;\n    } else {\n      this.dataViewHeight = this.$refs.laylout.clientHeight - 110;\n    }\n\n    var query = _objectSpread({}, this.$route.query);\n\n    if (query.hasOwnProperty('reload')) {\n      this.$nextTick(function () {\n        _this5.$refs[_this5.dataViewName].$emit('reload');\n      });\n      delete query.reload;\n      this.$router.replace({\n        query: query\n      });\n    }\n  },\n  created: function created() {\n    this.getCity();\n  }\n};",{"version":3,"sources":["Listting.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <v-layout ref=\"laylout\" column fill-height>\n   <div ref=\"header\">\n    <v-toolbar height=\"50px\" color=\"white\" flat>\n      <v-layout row wrap>\n        <v-flex xs1 :class=\"isMini && 'full-flex-basic max-width-col-2'\">\n          <v-tooltip bottom>\n            <v-btn slot=\"activator\" v-if=\"canAccess('branch.create')\" class=\"mt-3\" icon color=\"primary\" @click=\"$router.push({name: 'branch-create'})\">\n              <v-icon>add</v-icon>\n            </v-btn>\n            <span>Thêm mới</span>\n          </v-tooltip>\n        </v-flex>\n        <v-flex xs4 class=\"mt-1\" :class=\"isMini && 'full-flex-basic full-width-col-10'\">\n          <v-text-field\n          hide-details\n          single-line\n          placeholder=\"Nhập tên, sđt, email ...\"\n          v-model=\"filterQ\"\n          @keyup=\"changeSearch\"\n          clearable\n          @click:clear=\"changeSearch\"\n          ></v-text-field>\n        </v-flex>\n        <v-flex xs3 class='mt-1' :class=\"isMini && 'd-none'\">\n          <v-autocomplete\n          class='ml-2'\n          @change=\"changedCity\"\n          placeholder=\"Thành phố\"\n          item-text=\"name\"\n          item-value=\"id\"\n          :items=\"cityAll\"\n          v-model=\"filterByCity\"\n          hide-details\n          single-line\n          clearable\n          @click:clear=\"clearCity\"\n          >\n          <template slot=\"no-data\">\n            <v-list-tile>\n              <v-list-tile-title>\n                Không tìm thấy thành phố\n              </v-list-tile-title>\n            </v-list-tile>\n          </template>\n        </v-autocomplete>\n      </v-flex>\n      <v-flex xs3 class='mt-1' :class=\"isMini && 'd-none'\">\n        <v-autocomplete\n        :disabled = \"!filterByCity\"\n        class='ml-2'\n        @change=\"filter\"\n        placeholder=\"Quận huyện\"\n        item-text=\"name\"\n        item-value=\"id\"\n        :items=\"districtByCity\"\n        v-model=\"filterByDistrict\"\n        menu-props=\"auto\"\n        hide-details\n        single-line\n        clearable\n        >\n        <template slot=\"no-data\">\n          <v-list-tile>\n            <v-list-tile-title>\n              Không tìm thấy quân huyện\n            </v-list-tile-title>\n          </v-list-tile>\n        </template>\n      </v-autocomplete>\n    </v-flex>\n    <v-flex xs1 :class=\"isMini && 'd-none'\">\n      <v-tooltip bottom>\n        <v-btn class=\"mt-3 ml-4\" slot=\"activator\" icon color=\"primary\" @click=\"resetForm()\">\n          <v-icon>close</v-icon>\n        </v-btn>\n        <span>Reset bộ lọc</span>\n      </v-tooltip>\n    </v-flex>\n  </v-layout>\n  <v-layout slot=\"extension\" v-if=\"!isMini\">\n    <v-flex style=\"flex-basis:55px;\" sm1 class=\"text-bold\">\n      #\n    </v-flex>\n    <v-flex sm3 class=\"text-bold\">\n      Tên chi nhánh\n    </v-flex>\n    <v-flex sm3 class=\"text-bold\">\n      Địa chỉ\n    </v-flex>\n    <v-flex sm2 class=\"text-bold\">\n      Thành phố\n    </v-flex>\n    <v-flex sm2 class=\"text-bold\">\n      Quận, huyện\n    </v-flex>\n    <v-flex sm1 class=\"text-bold mr-3\">\n      Hành động\n    </v-flex>\n  </v-layout>\n</v-toolbar>\n</div>\n<v-flex xs12 class=\"border-e0-top\">\n  <data-view\n  :name=\"dataViewName\"\n  api-url=\"branches?sort=status:-1,id:-1\"\n  v-if=\"dataViewHeight\"\n  :viewHeight=\"dataViewHeight\"\n  :params=\"filterParams\"\n  :ref=\"dataViewName\"\n  >\n  <template slot-scope=\"{items}\">\n    <v-list three-line>\n      <template v-for=\"(item, index) in items.data\">\n        <v-list-tile\n        :key=\"'item' + item.id\"\n        avatar\n        @click=\"branchDetail(item)\"\n        :inactive=\"item.id === $route.params.id\"\n        :class=\"item.id === $route.params.id && 'grey lighten-2'\"\n        >\n        <v-layout class=\"pa-2\">\n          <v-flex style=\"flex-basis:55px;\" sm1 :class=\"isMini && 'd-none'\">\n            {{index + 1}}\n          </v-flex>\n          <v-flex sm3 :class=\"isMini && 'full-flex-basic full-max-width'\">\n            {{ item.name}}\n            <v-tooltip bottom v-if=\"item.type===1\">\n              <v-icon @click.stop class=\"mb-1\" size=\"15px\" slot=\"activator\" color=\"red\">fa fa-star</v-icon>\n              <span>Chi nhánh chính</span>\n            </v-tooltip>\n            <v-icon v-else id=\"subBranch\" @click.stop=\"updatedTypeBranch(item)\" class=\"mb-1\" size=\"15px\" slot=\"activator\" color=\"red lighten-4\">fa fa-star</v-icon>\n            <v-list-tile-sub-title class=\"text--primary copytext\" v-if=\"item.email\" :class=\"isMini && 'd-none'\">\n              <v-icon size=\"16px\">email</v-icon>\n              <span @click.stop=\"clickToCopy\" class=\"click-copy\">{{ item.email }}</span>\n            </v-list-tile-sub-title>\n            <v-list-tile-sub-title class=\"text--primary copytext\" v-if=\"item.phone\" :class=\"isMini && 'd-none'\">\n              <v-icon size=\"16px\">phone</v-icon>\n              <span @click.stop=\"clickToCopy\" class=\"click-copy\">{{ item.phone }}</span>\n            </v-list-tile-sub-title>\n          </v-flex>\n          <v-flex sm3 class=\"ml-1 pr-3\" :class=\"isMini && 'd-none'\">\n            {{ item.address }}\n          </v-flex>\n          <v-flex sm2 class='ml-2' :class=\"isMini && 'd-none'\">\n            {{ item.city_name }}\n          </v-flex>\n          <v-flex sm2 :class=\"isMini && 'd-none'\">\n            {{ item.district_name }}\n          </v-flex>\n          <v-flex sm1 :class=\"isMini && 'd-none'\">\n            <v-tooltip bottom sm6>\n              <v-btn slot=\"activator\" class=\"ma-0\" v-if=\"canAccess('branch.update')\" icon @click.stop=\"$router.push({name: 'branch-edit', params: {id: item.id}})\">\n                <v-icon class='theme--light teal--text'>edit</v-icon>\n              </v-btn>\n              <span>Sửa</span>\n            </v-tooltip>\n            <v-tooltip bottom sm6>\n              <v-btn slot=\"activator\" class=\"ma-0\" v-if=\"canAccess('branch.delete')\" icon @click.stop=\"removeConfirm(item)\">\n                <v-icon class=\"theme--light pink--text\">delete</v-icon>\n              </v-btn>\n              <span>Xóa</span>\n            </v-tooltip>\n            <v-tooltip bottom sm12>\n              <v-switch\n              @click.native.stop\n              @change=\"changeStatus(item.id)\"\n              class='ml-3'\n              name=\"status\"\n              slot=\"activator\"\n              v-model=\"item.status\"\n              ></v-switch>\n              <span v-if=\"item.status\">Hoạt Động</span>\n              <span v-else>Không hoạt động</span>\n            </v-tooltip>\n          </v-flex>\n        </v-layout>\n      </v-list-tile>\n      <v-divider\n      :key=\"'div' + index + item.id\"\n      v-if=\"index + 1 < items.data.length\"\n      ></v-divider>\n    </template>\n  </v-list>\n  <dialog-confirm v-model=\"dialogDelete\" @input=\"remove\" />\n</template>\n</data-view>\n</v-flex>\n</v-layout>\n</template>\n<script>\nimport { mapFields } from 'vuex-map-fields'\nimport { debounce, findIndex } from 'lodash'\nimport DialogConfirm from '@/components/DialogConfirm'\nimport DataView from '@/components/DataView/DataView'\nimport { mapActions, mapGetters } from 'vuex'\nexport default {\n  name: 'BranchListting',\n  components: {\n    DataView,\n    DialogConfirm\n  },\n  props: {\n    type: {\n      type: String,\n      default: 'index'\n    },\n    isMini: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data: () => ({\n    branch: {\n      status: 1,\n      type: 1\n    },\n    districtActive: false,\n    dialogDelete: false,\n    item: {},\n    idBranch: null,\n    title: [\n      { text: 'Tên chi nhánh', sortable: false },\n      { text: 'Email', sortable: false },\n      { text: 'Mã sô thuế', sortable: false },\n      { text: 'Địa chỉ', sortable: false },\n      { text: 'Trạng thái', sortable: false },\n      { text: 'Hành động', sortable: false }\n    ],\n    dataViewHeight: 0,\n    dataViewName: 'branch'\n  }),\n  computed: {\n    ...mapGetters('City', ['cityAll', 'districtByCity']),\n    ...mapGetters('Branch', ['filterParams']),\n    isIndex () {\n      return this.type === 'index'\n    },\n    isBranchMain () {\n      let array = this.$store.getters['Dataview/dataViews']('branch')\n      return array.data\n    },\n    ...mapFields(`Branch`, {\n      filterQ: 'params.q',\n      filterByCity: 'params.cityId',\n      filterByDistrict: 'params.districtId'\n    })\n  },\n  methods: {\n    ...mapActions(['setMiniDrawer']),\n    ...mapActions('Dataview', ['removeDataviewEntry', 'updateDataviewEntry']),\n    ...mapActions('Branch', ['getBranch', 'updateTypeBranch', 'deleteBranch', 'updateStatusBranch', 'clearFilter', 'clearFilterCity']),\n    ...mapActions(['showNotify', 'setMiniDrawer']),\n    ...mapActions('City', ['getCity', 'getDistrictByCity']),\n    branchDetail (branch) {\n      this.clearFilter()\n      this.filter()\n      this.getBranch({ branchId: branch.id })\n      // this.clearFilter()\n      this.$router.push({ name: 'branch-detail', params: { id: branch.id } })\n    },\n    clearCity () {\n      this.clearFilterCity()\n    },\n    resetForm () {\n      this.clearFilter()\n    },\n    changeSearch: debounce(function () {\n      this.filter()\n    }, 500),\n    changedCity: debounce(function (value) {\n      if (value) {\n        this.districtActive = true\n        this.getDistrictByCity({\n          cityId: value,\n          cb: () => {\n            this.districtAll = this.districtByCity\n          }\n        })\n      } else {\n        this.districtActive = false\n      }\n      this.filter()\n    }, 500),\n    filter () {\n      this.$refs[this.dataViewName].$emit('reload')\n    },\n    updatedTypeBranch (item) {\n      this.updateTypeBranch({\n        id: item.id,\n        cb: (response) => {\n          this.$store.dispatch('showNotify', {\n            text: this.$t('alert.updateTypeBranchSuccess'),\n            color: 'success'\n          })\n          // tìm trong mảng vị trí index có kiểu chi nhánh chính\n          let index = findIndex(this.isBranchMain, { type: 1 })\n          if (index > -1) {\n            let object = Object.assign({}, this.isBranchMain[index])\n            object.type = 0\n            this.updateDataviewEntry({\n              name: 'branch',\n              data: object,\n              key: 'id'\n            })\n          }\n          this.updateDataviewEntry({\n            name: 'branch',\n            data: response.data,\n            key: 'id'\n          })\n        },\n        error: (error) => {\n          if (error.status === 404) {\n            this.$store.dispatch('showNotify', {\n              text: this.$t('alert.not-found'),\n              color: 'warning'\n            })\n          }\n        }\n      })\n    },\n    changeStatus (idBranch) {\n      this.updateStatusBranch({\n        id: idBranch,\n        cb: (response) => {\n          this.$store.dispatch('showNotify', {\n            text: this.$t('alert.statusSuccess'),\n            color: 'success'\n          })\n        },\n        error: (error) => {\n          if (error.status === 404) {\n            this.$store.dispatch('showNotify', {\n              text: this.$t('alert.not-found'),\n              color: 'warning'\n            })\n          }\n        }\n      })\n    },\n    removeConfirm (item) {\n      this.branch = item\n      this.idBranch = item.id\n      this.dialogDelete = true\n    },\n    remove (confirm) {\n      if (confirm) {\n        this.deleteBranch({\n          id: this.idBranch,\n          cb: (response) => {\n            this.$store.dispatch('showNotify', {\n              text: this.$t('alert.deleteBranchSuccess'),\n              color: 'success'\n            })\n            this.removeDataviewEntry({\n              name: 'branch',\n              data: this.branch,\n              key: 'id'\n            })\n            this.dialogDelete = false\n          },\n          error: (error) => {\n            if (error.status === 404) {\n              this.$store.dispatch('showNotify', {\n                text: this.$t('alert.not-found'),\n                color: 'warning'\n              })\n            }\n          }\n        })\n      }\n    }\n  },\n  mounted () {\n    if (this.$route.params.id) {\n      this.dataViewHeight = this.$refs.laylout.clientHeight - 48\n    } else {\n      this.dataViewHeight = this.$refs.laylout.clientHeight - 110\n    }\n    let query = { ...this.$route.query }\n    if (query.hasOwnProperty('reload')) {\n      this.$nextTick(() => {\n        this.$refs[this.dataViewName].$emit('reload')\n      })\n      delete query.reload\n      this.$router.replace({\n        query: query\n      })\n    }\n  },\n  created () {\n    this.getCity()\n  }\n}\n</script>\n<style scoped>\n.v-toolbar__extension{\n  height: 43px;\n}\n#subBranch:hover{\n  caret-color: #f44336 !important;\n  color: #f44336 !important;\n  transition: all 1s 0.5s;\n}\n.copytext{\n  overflow: unset;\n}\n</style>\n"],"sourceRoot":"src/views/branch"}]}