{"remainingRequest":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/babel-loader/lib/index.js!/home/nguyenxuancuong/Sites/hrm_fe/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/nguyenxuancuong/Sites/hrm_fe/src/views/department/Listting.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/nguyenxuancuong/Sites/hrm_fe/src/views/department/Listting.vue","mtime":1543805124117},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/cache-loader/dist/cjs.js","mtime":1538403001796},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/@babel/runtime/helpers/builtin/es6/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapFields } from 'vuex-map-fields';\nimport DialogConfirm from '@/components/DialogConfirm';\nimport { debounce } from 'lodash';\nimport DataView from '@/components/DataView/DataView';\nimport { mapActions, mapGetters } from 'vuex';\nexport default {\n  name: 'UserListting',\n  props: {\n    isMini: {\n      type: Boolean,\n      default: false\n    }\n  },\n  components: {\n    DataView: DataView,\n    DialogConfirm: DialogConfirm\n  },\n  data: function data() {\n    return {\n      dataViewHeight: 0,\n      dataViewName: 'department',\n      idDepartment: null,\n      dialogDelete: false,\n      dialog: false,\n      dataDepartment: {},\n      editedIndex: -1,\n      editTitle: -1,\n      branches: [],\n      listBranch: [],\n      isLoadingBranchAdd: false,\n      isLoadingBranch: false,\n      department: {\n        name: '',\n        status: true,\n        branch_id: ''\n      },\n      params: {\n        q: '',\n        branch_id: ''\n      },\n      defaultItem: {}\n    };\n  },\n  computed: _objectSpread({\n    formTitle: function formTitle() {\n      return this.editTitle === -1 ? 'Thêm phòng ban' : 'Sửa phòng ban';\n    }\n  }, mapGetters('Branch', ['branchAll']), mapGetters('Department', ['departmentDetail', 'filterParams']), mapGetters(['isFetchingApi']), mapFields('Department', {\n    nameFilter: 'params.q',\n    branchFilter: 'params.branch_id'\n  })),\n  watch: {\n    dialog: function dialog(val) {\n      var _this = this;\n\n      val || this.close(); // autofocus for form\n\n      if (!val) return;\n      requestAnimationFrame(function () {\n        _this.$refs.firstInput.focus();\n      });\n    }\n  },\n  methods: _objectSpread({}, mapActions(['fetchApi']), mapActions(['setMiniDrawer']), mapActions(['showNotify', 'setMiniDrawer']), mapActions('Department', ['fetchDepartment', 'getDepartment', 'createDepartment', 'deleteDepartment', 'updateDepartment', 'updateStatusDepartment', 'clearFilter']), mapActions('Dataview', ['removeDataviewEntry', 'updateDataviewEntry']), mapActions('Branch', ['getBranchs', 'setBranch']), {\n    backTabIndex: function backTabIndex() {\n      this.$refs.firstInput.focus();\n    },\n    // reset filter\n    resetFilter: function resetFilter() {\n      this.clearFilter();\n      this.filter();\n    },\n    /// screach api branch\n    sreachBranch: debounce(function (value) {\n      var _this2 = this;\n\n      this.getBranchs({\n        params: {\n          q: value.target.value,\n          limit: 10\n        },\n        cb: function cb(params) {\n          _this2.listBranch = params;\n          console.log('data params', params);\n        }\n      });\n      this.isLoadingBranch = true;\n      setTimeout(function () {\n        _this2.isLoadingBranch = false;\n      }, 500);\n    }, 500),\n    closeBlur: function closeBlur() {\n      // nếu có thay đổi branch_id trong department thì thay đổi\n      if (this.department.id && this.department.branch_id !== this.department.branch.data.id) {\n        console.log(\"data response :\", this.department.branch_id); // this.setBranch({\n        //    branchs: [this.department.branch_id]\n        // })\n      } // mặc định không chọn branch_id ở ngoài 10 bản ghi thì lấy bản ghi cũ\n      else if (this.department.branch) {\n          this.setBranch({\n            branchs: [this.department.branch.data]\n          });\n        }\n    },\n    // serach api form add\n    sreachBranchAdd: debounce(function (value) {\n      var _this3 = this;\n\n      this.getBranchs({\n        params: {\n          q: value.target.value,\n          limit: 10\n        }\n      });\n      this.isLoadingBranchAdd = true;\n      setTimeout(function () {\n        _this3.isLoadingBranchAdd = false;\n      }, 500);\n    }, 500),\n    /// change status\n    changeStatus: function changeStatus(idDepartment) {\n      var _this4 = this;\n\n      this.updateStatusDepartment({\n        id: idDepartment,\n        cb: function cb(response) {\n          _this4.showNotify({\n            color: 'success',\n            text: _this4.$t('alert.status-edit-department')\n          });\n        }\n      });\n    },\n    // khi clear giá trị ô branch mặc định lấy 10 bản ghi\n    clearFilterBranch: function clearFilterBranch() {\n      this.getBranchs({\n        params: {\n          limit: 10\n        }\n      });\n    },\n    clearFilterBranchAdd: function clearFilterBranchAdd() {\n      this.getBranchs({\n        params: {\n          limit: 10\n        }\n      });\n    },\n    /// /label status\n    status_txt: function status_txt() {\n      if (this.department.status) {\n        this.status = 'Hiển thị';\n      } else {\n        this.status = 'Không hiển thị';\n      }\n    },\n    // dialog\n    openDialog: function openDialog() {\n      // reset validator\n      this.$validator.reset();\n      this.editTitle = -1;\n      this.getBranchs({\n        params: {\n          limit: 10\n        }\n      });\n      this.dialog = true;\n      this.department.status = true;\n    },\n    // end dialog\n    close: function close() {\n      var _this5 = this;\n\n      this.dialog = false;\n      setTimeout(function () {\n        _this5.department = Object.assign({}, _this5.defaultItem);\n        _this5.editedIndex = -1;\n      }, 300);\n    },\n    // đổ dữ liệu from edit\n    editItem: function editItem(item, id) {\n      this.$validator.reset();\n      this.editTitle = -2;\n      this.idDepartment = id; // lọc branch_id theo branch\n\n      this.getBranchs({\n        params: {\n          q: item.branch_name\n        }\n      });\n      this.editedIndex = this.departmentDetail.indexOf(item);\n      this.department = Object.assign({}, item);\n      this.status_txt();\n      this.dialog = true;\n      console.log('data item :', item);\n    },\n    validateBeforeSubmit: function validateBeforeSubmit() {\n      var _this6 = this;\n\n      // check validate\n      this.$validator.validateAll().then(function (result) {\n        if (result) {\n          _this6.submitForm();\n        } else {\n          _this6.$store.dispatch('showNotify', {\n            text: _this6.$t('alert.invalid'),\n            color: 'warning'\n          });\n        }\n      });\n    },\n    // add and edit data\n    submitForm: function submitForm() {\n      var _this7 = this;\n\n      if (this.editTitle === -1) {\n        var department = Object.assign({}, this.department);\n        department.status = department.status ? 1 : 0;\n        this.createDepartment({\n          department: department,\n          cb: function cb(response) {\n            _this7.dialog = false;\n            setTimeout(function () {\n              _this7.editedIndex = -1;\n            }, 300);\n\n            _this7.showNotify({\n              color: 'success',\n              text: _this7.$t('alert.add-department')\n            });\n\n            _this7.getBranchs({\n              params: {\n                limit: 10\n              }\n            });\n\n            _this7.resetFilter();\n          }\n        });\n      } else {\n        var _department = Object.assign({}, this.department);\n\n        _department.status = _department.status ? 1 : 0;\n        this.updateDepartment({\n          id: this.idDepartment,\n          department: _department,\n          cb: function cb(response) {\n            _this7.showNotify({\n              color: 'success',\n              text: _this7.$t('alert.edit-department')\n            });\n\n            _this7.updateDataviewEntry({\n              name: 'department',\n              data: response.data,\n              key: 'id'\n            });\n\n            _this7.dialog = false;\n            setTimeout(function () {\n              _this7.editedIndex = -1;\n            }, 300);\n          }\n        });\n      }\n    },\n    /// screach\n    changeSearch: debounce(function () {\n      this.filter();\n    }, 500),\n    filter: function filter() {\n      this.$refs[this.dataViewName].$emit('reload');\n    },\n    // xóa department\n    removeConfirm: function removeConfirm(item) {\n      this.dataDepartment = item;\n      this.idDepartment = item.id;\n      this.dialogDelete = true;\n    },\n    remove: function remove(confirm) {\n      var _this8 = this;\n\n      if (confirm) {\n        this.deleteDepartment({\n          id: this.idDepartment,\n          cb: function cb(response) {\n            _this8.removeDataviewEntry({\n              name: 'department',\n              data: _this8.dataDepartment,\n              key: 'id'\n            });\n\n            _this8.$store.dispatch('showNotify', {\n              text: _this8.$t('alert.delete-department'),\n              color: 'success'\n            });\n\n            _this8.dialogDelete = false;\n          },\n          error: function error(_error) {\n            if (_error.status === 404) {\n              _this8.$store.dispatch('showNotify', {\n                text: _this8.$t('alert.not-found'),\n                color: 'warning'\n              });\n            }\n          }\n        });\n      }\n    }\n  }),\n  mounted: function mounted() {\n    var _this9 = this;\n\n    // mặc định lấy 10 bản ghi\n    if (!this.branchAll.length) {\n      this.getBranchs({\n        params: {\n          limit: 10\n        }\n      });\n    } // mặc định lấy 10 bản ghi screach\n\n\n    if (!this.listBranch.length) {\n      this.getBranchs({\n        params: {\n          limit: 10\n        },\n        cb: function cb(params) {\n          _this9.listBranch = params;\n          console.log('data params', params);\n        }\n      });\n    }\n\n    this.dataViewHeight = this.$refs.laylout.clientHeight - 122;\n\n    var query = _objectSpread({}, this.$route.query);\n\n    if (query.hasOwnProperty('reload')) {\n      this.$nextTick(function () {\n        _this9.$refs[_this9.dataViewName].$emit('reload');\n      });\n      delete query.reload;\n      this.$router.replace({\n        query: query\n      });\n    }\n  }\n};",{"version":3,"sources":["Listting.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <v-layout ref=\"laylout\" column fill-height>\n    <div ref=\"header\">\n      <v-toolbar height=\"60px\" color=\"white\" flat>\n        <v-layout row wrap>\n          <v-flex xl1 lg1 md1 sm1  xs2 :class=\"isMini\">\n            <!--  <v-tooltip bottom> -->\n            <v-tooltip bottom>\n              <v-btn slot=\"activator\" v-if=\"canAccess('department.create')\"\n              class=\"mr-3 mt-4\" icon color=\"primary\"\n              @click=\"openDialog\">\n              <v-icon>add</v-icon\n                >\n              </v-btn>\n              <span>Thêm mới</span>\n            </v-tooltip>\n            <!--  <span>Thêm mới</span> -->\n            <!-- </v-tooltip> -->\n          </v-flex>\n          <v-flex xl5 lg5 md5 sm5 xs9 class=\"mt-1 paddRight-4\" :class=\"isMini && 'full-flex-basic'\">\n             <v-text-field\n             hide-details\n             single-line\n             slot=\"activator\"\n             placeholder=\"Nhập  phòng ban\"\n             v-model=\"nameFilter\"\n             @keyup=\"changeSearch\"\n             @click:clear=\"changeSearch\"\n             clearable\n             ></v-text-field>\n         </v-flex>\n         <v-flex  xl5 lg5 md5 sm5  class='mt-1 display'  :class=\"isMini && 'd-none'\">\n          <v-autocomplete\n          v-model=\"branchFilter\"\n          :items=\"listBranch\"\n          @keyup=\"sreachBranch\"\n          @change=\"filter\"\n          @click:clear=\"clearFilterBranch\"\n          item-text=\"name\"\n          clearable\n          item-value=\"id\"\n          :loading=\"isLoadingBranch\"\n          placeholder=\"Chọn chi nhánh\"\n          >\n             <template slot=\"no-data\">\n              <v-list-tile>\n                <v-list-tile-title style=\"color: blue\">\n                Không có   chi nhánh  này trong hệ thống\n                </v-list-tile-title>\n              </v-list-tile>\n            </template>\n          </v-autocomplete>\n        </v-flex>\n        <!--dialog-->\n        <v-dialog v-model=\"dialog\" max-width=\"500px\">\n          <v-card>\n            <form @submit.prevent=\"validateBeforeSubmit\">\n              <v-card-title>\n                <span class=\"headline\" width=\"100%\" style=\"margin:0 auto\">{{ formTitle }}</span>\n              </v-card-title>\n              <v-divider></v-divider>\n              <v-card-text id=\"formSub\">\n                <v-container grid-list-md>\n                  <v-layout wrap>\n                    <!-- name -->\n                    <v-flex xs12 sm6 md12>\n                      <v-text-field\n                      placeholder=\"Nhập tên phòng ban\"\n                      :error-messages=\"errors.has('name_department') ? errors.collect('name_department') : []\"\n                      v-validate=\"'required'\"\n                      :label=\"$t('label.name_department')\"\n                      :tabindex=\"1\"\n                      ref=\"firstInput\"\n                      class=\"input-required\"\n                      :data-vv-as=\"$t('label.name_department')\"\n                      name=\"name_department\"\n                      autofocus\n                      v-model=\"department.name\">\n                    </v-text-field>\n                  </v-flex>\n                  <!-- value -->\n                  <!--branch_id-->\n                   <v-flex md12>\n            <v-autocomplete\n            :loading=\"isLoadingBranchAdd\"\n            :error-messages=\"errors.has('name_branch') ? errors.collect('name_branch') : []\"\n            v-validate=\"'required'\"\n            :data-vv-as=\"$t('label.name_branch')\"\n            v-model=\"department.branch_id\"\n            :items=\"branchAll\"\n            :tabindex=\"2\"\n            @blur=\"closeBlur()\"\n            @keyup=\"sreachBranchAdd\"\n            @click:clear=\"clearFilterBranchAdd\"\n            item-text=\"name\"\n            clearable\n            item-value=\"id\"\n            :label=\"$t('label.name_branch')\"\n             class=\"input-required\"\n             name=\"name_branch\"\n             placeholder=\"Chọn chi nhánh\"\n            >\n            <template slot=\"no-data\">\n              <v-list-tile>\n                <v-list-tile-title style=\"color:blue\">\n                Không có  chi nhánh  này trong hệ thống\n                </v-list-tile-title>\n              </v-list-tile>\n            </template>\n          </v-autocomplete> </v-flex>\n                 <v-flex xs12 sm6 md12>\n                  <label class=\"title-department\">Trạng thái</label>\n                  <v-flex xs1>\n                    <v-tooltip bottom>\n                      <v-switch\n                      @click.native.stop\n                      class=''\n                      style=\"outline-style: none;\"\n                      :tabindex=\"3\"\n                      name=\"status\"\n                      slot=\"activator\"\n                      v-model=\"department.status\"\n                      ></v-switch>\n                      <span v-if=\"department.status\">Hiển thị</span>\n                      <span v-else>Không hiển thị</span>\n                    </v-tooltip>\n                  </v-flex>\n                </v-flex>\n              </v-layout>\n            </v-container>\n            <v-divider></v-divider>\n          </v-card-text>\n          <v-card-actions>\n            <v-spacer></v-spacer>\n            <v-btn color=\"error darken-1\" :tabindex=\"4\" flat  @click.native=\"close\" class=\"ml-2\">Hủy bỏ</v-btn>\n            <v-btn flat\n            :tabindex=\"5\"\n            :loading=\"isFetchingApi\"\n            :disabled=\"isFetchingApi\"\n            type=\"submit\"\n            color=\"success darken-1\">\n            <span v-if=\"editTitle==-2\">Lưu lại</span><span v-else>Thêm mới</span>\n          </v-btn>\n          <div :tabindex=\"6\" @focus=\"backTabIndex\"></div>\n        </v-card-actions>\n      </form>\n    </v-card>\n  </v-dialog>\n</v-layout>\n<v-layout slot=\"extension\" class=\"pt-2 pb-2\" v-if=\"!isMini\">\n <v-flex xl1 lg1 md1 sm1 xs1  class=\"text-bold flex-basis\">\n  #\n</v-flex>\n<v-flex xl4 lg4 md4 sm4 xs4 class=\"text-bold\">\n  Phòng ban\n</v-flex>\n<v-flex xl4 lg4 md4 sm4 xs4 class=\"text-bold\">\n  Chi nhánh\n</v-flex>\n<v-flex xl2 lg2 md2 sm2 xs2 class=\"text-bold\">\n  <v-flex sm12> Trạng thái </v-flex>\n</v-flex>\n<v-flex xl1 lg1 md1 sm1 xs1  class=\"text-bold\">\n  Hành động\n</v-flex>\n</v-layout>\n</v-toolbar>\n</div>\n<v-flex xs12 class=\"border-e0-top\">\n  <data-view\n  :name=\"dataViewName\"\n  api-url=\"departments?include=branch&sort=status:-1,id:-1\"\n  v-if=\"dataViewHeight\"\n  :viewHeight=\"dataViewHeight\"\n  :params=\"filterParams\"\n  :ref=\"dataViewName\"\n  >\n  <template slot-scope=\"{items}\">\n    <v-list>\n      <template v-for=\"(item, index) in items.data\">\n       <v-list-tile class=\"lighten-2 v-list-tile\"  :key=\"index\">\n         <v-layout>\n           <v-flex class=\"flex-basis\" xl1 lg1 md1 sm1 xs1   :class=\"isMini && 'd-none'\">\n            {{index + 1}}\n          </v-flex>\n          <v-flex xl4 lg4 md4 sm4 xs4 class=\"paddRight-5\" :class=\"isMini && 'd-none'\">\n            {{ item.name }}\n          </v-flex>\n          <v-flex  xl4 lg4 md4 sm4 xs4 class=\"paddRight-5\" :class=\"isMini && 'd-none'\">\n            {{ item.branch_name }}\n          </v-flex>\n          <v-flex xl2 lg2 md2 sm2 xs2  class=\"paddingLeft-10\" :class=\"isMini && 'd-none'\">\n           <v-tooltip bottom sm12>\n            <v-switch\n            @click.native.stop\n            @change=\"changeStatus(item.id)\"\n            name=\"status\"\n            slot=\"activator\"\n            v-model=\"item.status\"\n            ></v-switch>\n            <span v-if=\"item.status\">Hiển thị</span>\n            <span v-else>Không hiển thị</span>\n          </v-tooltip>\n        </v-flex>\n        <v-flex xl1 lg1 md1 sm1 xs1  :class=\"isMini && 'd-none'\">\n          <v-tooltip bottom>\n            <v-btn slot=\"activator\" class=\"ma-0\" v-if=\"canAccess('department.update')\" icon @click=\"editItem(item,item.id)\">\n              <v-icon class='theme--light teal--text'>edit</v-icon>\n            </v-btn>\n            <span>Sửa</span>\n          </v-tooltip>\n          <v-tooltip bottom>\n            <v-btn slot=\"activator\" class=\"ma-0\" v-if=\"canAccess('department.delete')\" icon @click.stop=\"removeConfirm(item)\">\n              <v-icon class=\"theme--light pink--text\">delete</v-icon>\n            </v-btn>\n            <span>Xóa</span>\n          </v-tooltip>\n        </v-flex>\n      </v-layout>\n    </v-list-tile>\n    <v-divider\n    :key=\"'div'  + item.id\"\n    v-if=\"index + 1 < items.data.length\"\n    ></v-divider>\n  </template>\n</v-list>\n</template>\n</data-view>\n</v-flex>\n<dialog-confirm v-model=\"dialogDelete\" @input=\"remove\" />\n</v-layout>\n</template>\n<script>\nimport { mapFields } from 'vuex-map-fields'\nimport DialogConfirm from '@/components/DialogConfirm'\nimport { debounce } from 'lodash'\nimport DataView from '@/components/DataView/DataView'\nimport { mapActions, mapGetters } from 'vuex'\nexport default{\n  name: 'UserListting',\n  props: {\n    isMini: {\n      type: Boolean,\n      default: false\n    }\n  },\n  components: {\n    DataView,\n    DialogConfirm\n  },\n  data: () => ({\n    dataViewHeight: 0,\n    dataViewName: 'department',\n    idDepartment: null,\n    dialogDelete: false,\n    dialog: false,\n    dataDepartment: {},\n    editedIndex: -1,\n    editTitle: -1,\n    branches: [],\n    listBranch: [],\n    isLoadingBranchAdd: false,\n    isLoadingBranch: false,\n    department: {\n      name: '',\n      status: true,\n      branch_id: ''\n    },\n    params: {\n      q: '',\n      branch_id: ''\n    },\n    defaultItem: {\n    }\n  }),\n  computed: {\n    formTitle () {\n      return this.editTitle === -1 ? 'Thêm phòng ban' : 'Sửa phòng ban'\n    },\n    ...mapGetters('Branch', ['branchAll']),\n    ...mapGetters('Department', ['departmentDetail', 'filterParams']),\n    ...mapGetters(['isFetchingApi']),\n    ...mapFields('Department', {\n      nameFilter: 'params.q',\n      branchFilter: 'params.branch_id'\n    })\n  },\n  watch: {\n    dialog (val) {\n      val || this.close()\n      // autofocus for form\n      if (!val) return\n      requestAnimationFrame(() => {\n        this.$refs.firstInput.focus()\n      })\n    }\n  },\n  methods: {\n    ...mapActions(['fetchApi']),\n    ...mapActions(['setMiniDrawer']),\n    ...mapActions(['showNotify', 'setMiniDrawer']),\n    ...mapActions('Department', ['fetchDepartment', 'getDepartment', 'createDepartment', 'deleteDepartment', 'updateDepartment', 'updateStatusDepartment', 'clearFilter']),\n    ...mapActions('Dataview', ['removeDataviewEntry', 'updateDataviewEntry']),\n    ...mapActions('Branch', ['getBranchs', 'setBranch']),\n    backTabIndex () {\n      this.$refs.firstInput.focus()\n    },\n    // reset filter\n    resetFilter () {\n      this.clearFilter()\n      this.filter()\n    },\n    /// screach api branch\n    sreachBranch: debounce(function (value) {\n      this.getBranchs({\n        params: { q: value.target.value, limit: 10 },\n        cb: (params) => {\n          this.listBranch = params\n          console.log('data params', params)\n        }\n      })\n      this.isLoadingBranch = true\n      setTimeout(() => {\n        this.isLoadingBranch = false\n      }, 500)\n    }, 500),\n\n    closeBlur () {\n      // nếu có thay đổi branch_id trong department thì thay đổi\n      if (this.department.id && this.department.branch_id !== this.department.branch.data.id) {\n          console.log(\"data response :\", this.department.branch_id)\n          // this.setBranch({\n          //    branchs: [this.department.branch_id]\n          // })\n      }\n      // mặc định không chọn branch_id ở ngoài 10 bản ghi thì lấy bản ghi cũ\n      else if (this.department.branch) {\n        this.setBranch({\n          branchs: [this.department.branch.data]\n        })\n      }\n    },\n    // serach api form add\n    sreachBranchAdd: debounce(function (value) {\n      this.getBranchs({ params: { q: value.target.value, limit: 10 } })\n      this.isLoadingBranchAdd = true\n      setTimeout(() => {\n        this.isLoadingBranchAdd = false\n      }, 500)\n    }, 500),\n    /// change status\n    changeStatus (idDepartment) {\n      this.updateStatusDepartment({\n        id: idDepartment,\n        cb: (response) => {\n          this.showNotify({\n            color: 'success',\n            text: this.$t('alert.status-edit-department')\n          })\n        }\n      })\n    },\n    // khi clear giá trị ô branch mặc định lấy 10 bản ghi\n    clearFilterBranch () {\n      this.getBranchs({ params: { limit: 10 } })\n    },\n    clearFilterBranchAdd () {\n      this.getBranchs({ params: { limit: 10 } })\n    },\n    /// /label status\n    status_txt () {\n      if (this.department.status) {\n        this.status = 'Hiển thị'\n      } else {\n        this.status = 'Không hiển thị'\n      }\n    },\n    // dialog\n    openDialog () {\n      // reset validator\n      this.$validator.reset()\n      this.editTitle = -1\n      this.getBranchs({ params: { limit: 10 } })\n      this.dialog = true\n      this.department.status = true\n    },\n    // end dialog\n    close () {\n      this.dialog = false\n      setTimeout(() => {\n        this.department = Object.assign({}, this.defaultItem)\n        this.editedIndex = -1\n      }, 300)\n    },\n    // đổ dữ liệu from edit\n    editItem (item, id) {\n      this.$validator.reset()\n      this.editTitle = -2\n      this.idDepartment = id\n      // lọc branch_id theo branch\n      this.getBranchs({ params: { q: item.branch_name } })\n      this.editedIndex = this.departmentDetail.indexOf(item)\n      this.department = Object.assign({}, item)\n      this.status_txt()\n      this.dialog = true\n      console.log('data item :', item)\n    },\n    validateBeforeSubmit () {\n      // check validate\n      this.$validator.validateAll().then(result => {\n        if (result) {\n          this.submitForm()\n        } else {\n          this.$store.dispatch('showNotify', {\n            text: this.$t('alert.invalid'),\n            color: 'warning'\n          })\n        }\n      })\n    },\n    // add and edit data\n    submitForm () {\n      if (this.editTitle === -1) {\n        let department = Object.assign({}, this.department)\n        department.status = department.status ? 1 : 0\n        this.createDepartment({\n          department: department,\n          cb: (response) => {\n            this.dialog = false\n            setTimeout(() => {\n              this.editedIndex = -1\n            }, 300)\n            this.showNotify({\n              color: 'success',\n              text: this.$t('alert.add-department')\n            })\n            this.getBranchs({ params: { limit: 10 } })\n            this.resetFilter()\n          }\n        })\n      } else {\n        let department = Object.assign({}, this.department)\n        department.status = department.status ? 1 : 0\n        this.updateDepartment({\n          id: this.idDepartment,\n          department: department,\n          cb: (response) => {\n            this.showNotify({\n              color: 'success',\n              text: this.$t('alert.edit-department')\n            })\n            this.updateDataviewEntry({\n              name: 'department',\n              data: response.data,\n              key: 'id'\n            })\n            this.dialog = false\n            setTimeout(() => {\n              this.editedIndex = -1\n            }, 300)\n          }\n        })\n      }\n    },\n    /// screach\n    changeSearch: debounce(function () {\n      this.filter()\n    }, 500),\n    filter () {\n      this.$refs[this.dataViewName].$emit('reload')\n    },\n    // xóa department\n    removeConfirm (item) {\n      this.dataDepartment = item\n      this.idDepartment = item.id\n      this.dialogDelete = true\n    },\n    remove (confirm) {\n      if (confirm) {\n        this.deleteDepartment({\n          id: this.idDepartment,\n          cb: (response) => {\n            this.removeDataviewEntry({\n              name: 'department',\n              data: this.dataDepartment,\n              key: 'id'\n            })\n            this.$store.dispatch('showNotify', {\n              text: this.$t('alert.delete-department'),\n              color: 'success'\n            })\n            this.dialogDelete = false\n          },\n          error: (error) => {\n            if (error.status === 404) {\n              this.$store.dispatch('showNotify', {\n                text: this.$t('alert.not-found'),\n                color: 'warning'\n              })\n            }\n          }\n        })\n      }\n    }\n  },\n  mounted () {\n    // mặc định lấy 10 bản ghi\n    if (!this.branchAll.length) {\n      this.getBranchs({ params: { limit: 10 } })\n    }\n    // mặc định lấy 10 bản ghi screach\n    if (!this.listBranch.length) {\n      this.getBranchs({\n        params: { limit: 10 },\n        cb: (params) => {\n          this.listBranch = params\n          console.log('data params', params)\n        }\n      })\n    }\n    this.dataViewHeight = this.$refs.laylout.clientHeight - 122\n    let query = { ...this.$route.query }\n    if (query.hasOwnProperty('reload')) {\n      this.$nextTick(() => {\n        this.$refs[this.dataViewName].$emit('reload')\n      })\n      delete query.reload\n      this.$router.replace({\n        query: query\n      })\n    }\n  }\n}\n</script>\n<style scoped>\n  .v-toolbar__extension{\n    height: 60px !important;\n  }\n  .v-input.v-text-field{\n    margin-top: 11px !important;\n  }\n  .title-department{\n   color: #67757c;\n   -webkit-transform: translateY(-25px) translateX(-12px);\n   transform: translateY(-25px) translateX(-12px);\n   top: 0;\n }\n .v-input--selection-controls{\n  margin-top: 0px;\n}\n.v-card__text{\n  padding: 0px !important\n}\n@media (min-width: 1264px){\n    .flex-basis{\n      flex-basis:55px;\n    }\n  }\n  @media (min-width: 960px){\n    .flex-basis{\n      flex-basis:55px;\n    }\n\n    .v-list-tile{\n     height: 48px !important;\n     padding: 0 11px !important;\n\n    }\n  }\n  @media (min-width: 600px){\n    .flex-basis{\n      flex-basis:55px;\n    }\n    .paddRight-4{\n      padding-right: 10px;\n    }\n    .paddingLeft-10{\n      padding-left: 10px;\n    }\n    .paddRight-5{\n       padding-right: 5px !important;\n    }\n\n    .v-list-tile{\n      height: 76px !important;\n      padding-top: 16px !important;\n    }\n\n    .display{\n      display: block !important;\n    }\n\n  }\n  @media (min-width: 425px){\n  }\n  @media (min-width: 250px){\n    .flex-basis{\n      flex-basis:55px;\n      margin-right: 10px;\n    }\n    .display{\n      display: none;\n    }\n    .paddRight-5{\n       padding-right: 10px;\n    }\n    .v-list-tile{\n   height: 117px;\n    padding-top: 35px;\n    }\n\n  }\n\n   </style>\n"],"sourceRoot":"src/views/department"}]}