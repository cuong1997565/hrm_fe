{"remainingRequest":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/nguyenxuancuong/Sites/hrm_fe/src/views/plans/Form.vue?vue&type=style&index=0&id=2e8b1afa&scoped=true&lang=css&","dependencies":[{"path":"/home/nguyenxuancuong/Sites/hrm_fe/src/views/plans/Form.vue","mtime":1543377608179},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/postcss-loader/lib/index.js","mtime":499162500000},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/cache-loader/dist/cjs.js","mtime":1538403001796},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\niframe {\n  height: 300px !important;\n}\n",{"version":3,"sources":["Form.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+SA;AACA;AACA","file":"Form.vue","sourceRoot":"src/views/plans","sourcesContent":["<template>\n  <v-form @submit.prevent=\"validateBeforeSubmit\">\n    <v-container fluid style=\"position:relative\">\n      <v-layout row>\n        <v-flex xs6>\n          <v-text-field\n            tabindex=\"1\"\n            class=\"input-required\"\n            :error-messages=\"errors.has('title') ? errors.collect('title') : []\"\n            v-validate=\"'required|min:3'\"\n            :data-vv-as=\"$t('label.title')\"\n            name=\"title\"\n            placeholder=\"Tiêu đề\"\n            autofocus\n            :label=\"$t('label.title')\"\n            v-model=\"plan.title\">\n          </v-text-field>\n\n          <template>\n            <v-menu\n              class=\"input-required\"\n              ref=\"dateStart\"\n              :close-on-content-click=\"false\"\n              v-model=\"dateStart\"\n              :nudge-right=\"40\"\n              lazy transition=\"scale-transition\"\n              offset-y\n              full-width\n              min-width=\"290px\">\n              <v-text-field\n                tabindex=\"3\"\n                placeholder=\"Nhập ngày bắt đầu\"\n                slot=\"activator\"\n                v-model=\"plan.date_start\"\n                label=\"Ngày bắt đầu\"\n                readonly></v-text-field>\n              <v-date-picker\n                v-model=\"plan.date_start\"\n                :min=\"new Date().toISOString().substr(0, 10)\"\n                no-title @input=\"dateStart = false\"\n              ></v-date-picker>\n            </v-menu>\n          </template>\n        </v-flex>\n\n        <v-flex xs6>\n          <v-select\n            tabindex=\"2\"\n            :items=\"status\"\n            :disabled=\"isCreate\"\n            v-model=\"plan.status\"\n            item-text=\"name\"\n            item-value=\"id\"\n            name=\"status\"\n            :label=\"$t('label.status')\"\n          ></v-select>\n\n          <template>\n            <v-menu\n              class=\"input-required\"\n              ref=\"dateEnd\"\n              :close-on-content-click=\"false\"\n              v-model=\"dateEnd\"\n              :nudge-right=\"40\"\n              lazy transition=\"scale-transition\"\n              offset-y\n              full-width\n              min-width=\"290px\">\n              <v-text-field\n                tabindex=\"4\"\n                placeholder=\"Nhập ngày kết thúc\"\n                slot=\"activator\"\n                v-model=\"plan.date_end\"\n                label=\"Ngày kết thúc\"\n                readonly></v-text-field>\n              <v-date-picker\n                v-model=\"plan.date_end\"\n                :min=\"new Date().toISOString().substr(0, 10)\"\n                no-title @input=\"dateEnd = false\"\n              ></v-date-picker>\n            </v-menu>\n          </template>\n        </v-flex>\n      </v-layout>\n\n      <v-layout row wrap>\n        <v-flex xs12>\n          <label style=\"color:#67757c; font-size: 16px; margin-bottom: 3px\">Nội dung</label>\n          <tinymce\n            id=\"d1\"\n            tabindex=\"5\"\n            class=\"mr-1\"\n            v-model=\"plan.content\"\n            :other_options=\"{ height: '300px', images_upload_handler: handleImageAdded }\"\n            placeholder=\"Nhập nội dung\"\n            :error-messages=\"errors.has('content') ? errors.collect('content') : []\"\n            :data-vv-as=\"$t('label.content')\"\n            name=\"content\"\n            @editorInit=\"setEditorContent($event, plan.content)\"\n            :label=\"$t('label.content')\"\n          ></tinymce>\n        </v-flex>\n\n        <!-- form sub -->\n        <!--  khi create -->\n      </v-layout>\n      <formsub\n        ref=\"formSub\"\n        :dataPlan=\"plan\"\n        v-on:positionAndDepartment=\"positionAndDepartment($event)\">\n      </formsub>\n      <v-layout>\n        <v-flex xs12 text-xs-center>\n          <v-btn\n            :loading=\"isFetchingApi\"\n            :disabled=\"isFetchingApi\"\n            color=\"primary\"\n            type=\"submit\">\n            <template v-if=\"isCreate\">\n              <v-icon left>add</v-icon>\n              {{$t('control.create')}}\n            </template>\n            <template v-else>\n              <v-icon left>save</v-icon>\n              {{$t('control.save')}}\n            </template>\n          </v-btn>\n        </v-flex>\n      </v-layout>\n    </v-container>\n  </v-form>\n</template>\n<script>\nimport axios from 'axios'\nimport formsub from './Form_sub'\nimport DialogConfirm from '@/components/DialogConfirm'\nimport { mapGetters, mapActions } from 'vuex'\nexport default {\n  name: 'PlanForm',\n  components: {\n    formsub,\n    DialogConfirm\n  },\n  computed: {\n    ...mapGetters(['isFetchingApi']),\n    isCreate () {\n      return this.type === 'create'\n    }\n  },\n  props: {\n    type: {\n      type: String,\n      default: 'create'\n    },\n    dataPlan: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    }\n  },\n  data () {\n    return {\n      dateStart: false,\n      dateEnd: false,\n      plan: {\n        title: '',\n        content: '',\n        status: 0,\n        date_start: null,\n        date_end: null,\n        details: []\n      },\n      status: [\n        { 'id': 0, 'name': 'Mới' },\n        { 'id': 1, 'name': 'Chờ duyệt' },\n        { 'id': 2, 'name': 'Đã duyệt' },\n        { 'id': 3, 'name': 'Không duyệt' },\n        { 'id': 4, 'name': 'Hoàn thành' },\n        { 'id': 5, 'name': 'Hủy' }\n      ]\n    }\n  },\n  watch: {\n    dataPlan () {\n      this.setInitData()\n    },\n    dateStart (val) {\n      this.plan.date_start = this.formatDate(this.plan.date_start)\n    },\n    dateEnd (val) {\n      this.plan.date_end = this.formatDate(this.plan.date_end)\n    }\n  },\n\n  methods: {\n    ...mapActions(['fetchApi']),\n    setEditorContent (e, content) {\n      e.setContent(content || '')\n    },\n    formatDate (date) {\n      if (!date) return null\n      const [year, month, day] = date.split('-')\n      return `${year}-${month}-${day}`\n    },\n    save (date) {\n      this.$refs.dateEnd.save(date)\n    },\n    dateStarts () {\n      let today = new Date()\n      let dd = today.getDate()\n      let mm = today.getMonth() + 1\n      let yyyy = today.getFullYear()\n      if (dd < 10) {\n        dd = '0' + dd\n      }\n      if (mm < 10) {\n        mm = '0' + mm\n      }\n      today = yyyy + '-' + mm + '-' + dd\n      this.plan.date_start = today\n    },\n    // thời gian kết thúc\n    dateEnds () {\n      let today = new Date()\n      let dd = today.getDate()\n      let mm = today.getMonth() + 3\n      let yyyy = today.getFullYear()\n      if (dd < 10) {\n        dd = '0' + dd\n      }\n      if (mm < 10) {\n        mm = '0' + mm\n      }\n      today = yyyy + '-' + mm + '-' + dd\n      this.plan.date_end = today\n    },\n    handleImageAdded: async function (file, success, failure) {\n      let formData = new FormData()\n      formData.append('file', file.blob())\n      try {\n        let response = await axios.post('/blogs/upload', formData)\n        if (response.data.code === 1) {\n          success(response.data.data.path)\n        } else {\n          return false\n        }\n      } catch (err) {\n        if (err.status === 422) {\n          this.$store.dispatch('showNotify', {\n            text: this.$t('alert.error'),\n            color: 'error'\n          })\n        }\n      }\n    },\n    validateBeforeSubmit () {\n      this.$refs.formSub.validateBeforeSubmit()\n      this.$validator.validateAll().then(result => {\n        if (result) {\n          let submitData = { ...this.plan }\n          this.$emit('submit', submitData)\n        } else {\n          this.$store.dispatch('showNotify', {\n            text: this.$t('alert.invalid'),\n            color: 'warning'\n          })\n        }\n      })\n    },\n    positionAndDepartment (updated) {\n      this.plan.details = updated\n    },\n    setInitData () {\n      let dataPlan = { ...this.dataPlan }\n      this.plan = { ...this.plan, ...dataPlan }\n      if (this.plan.details.data) {\n        this.plan.details.data.map((item) => {\n          if (item.department) {\n            if (item.department.data.branch) {\n              item.branchs = [item.department.data.branch.data]\n              item.positions = [\n                {\n                  'id': item.position_id,\n                  'name': item.position_txt\n                }\n              ]\n            }\n          }\n          return item\n        })\n      }\n    }\n\n  },\n  created () {\n    this.dateEnds()\n    this.dateStarts()\n    !!this.dataPlan && this.setInitData()\n  }\n}\n</script>\n<style scoped>\n  iframe {\n    height: 300px !important;\n  }\n</style>\n"]}]}