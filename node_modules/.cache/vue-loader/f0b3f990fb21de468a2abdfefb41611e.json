{"remainingRequest":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/nguyenxuancuong/Sites/hrm_fe/src/views/department/Listting.vue?vue&type=style&index=0&id=015f4fc2&scoped=true&lang=css&","dependencies":[{"path":"/home/nguyenxuancuong/Sites/hrm_fe/src/views/department/Listting.vue","mtime":1538389483503},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/css-loader/index.js","mtime":1534394480905},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1536410629618},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/postcss-loader/lib/index.js","mtime":1534394481185},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/cache-loader/dist/cjs.js","mtime":1534394480737},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/vue-loader/lib/index.js","mtime":1536410629618}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.v-toolbar__extension{\n  height: 66px !important;\n}\n.v-input.v-text-field{\n  margin-top: 0px !important;\n}\n",{"version":3,"sources":["Listting.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsWA;AACA;AACA;AACA;AACA;AACA","file":"Listting.vue","sourceRoot":"src/views/department","sourcesContent":["<template>\n  <v-layout ref=\"laylout\" column fill-height>\n    <div ref=\"header\">\n      <v-toolbar height=\"60px\" color=\"white\" flat>\n        <v-layout row wrap>\n          <v-flex md1 xs3 :class=\"isMini\">\n            <!--  <v-tooltip bottom> -->\n            <v-tooltip bottom>\n              <v-btn slot=\"activator\" v-if=\"canAccess('department.create')\"\n              class=\"mr-3 mt-3\" icon color=\"primary\"\n              @click=\"openDialog\">\n              <v-icon>add</v-icon\n                ></v-btn>\n                <span>Thêm mới</span>\n              </v-tooltip>\n              <!--  <span>Thêm mới</span> -->\n              <!-- </v-tooltip> -->\n            </v-flex>\n            <v-flex xs5 class=\"mt-1 mr-2\" :class=\"isMini && 'full-flex-basic'\">\n              <v-text-field\n              hide-details\n              single-line\n              placeholder=\"Nhập tên phòng ban\"\n              v-model=\"params.q\"\n              @keyup=\"changeSearch\"\n              clearable\n              ></v-text-field>\n            </v-flex>\n            <v-flex xs5 class='mt-1' :class=\"isMini && 'd-none'\">\n              <v-autocomplete\n              v-if=\"Array.isArray(branchAll)\"\n              :items=\"branchAll\"\n              item-value=\"id\"\n              item-text=\"name\"\n              v-model=\"params.branch_id\"\n              @change=\"filter\"\n              placeholder=\"Xin vui lòng nhập tên chi nhánh\"\n              >\n            </v-autocomplete>\n          </v-flex>\n\n          <!--dialog-->\n          <v-dialog v-model=\"dialog\" max-width=\"500px\">\n           <v-card>\n            <v-card-title>\n              <span class=\"headline\">{{ formTitle }}</span>\n            </v-card-title>\n            <v-card-text id=\"formSub\">\n              <v-container grid-list-md>\n                <v-layout wrap>\n                  <!-- name -->\n                  <v-flex xs12 sm6 md12>\n                    <v-text-field\n                    placeholder=\"Nhập tên phòng ban\"\n                    :error-messages=\"errors.has('name') ? errors.collect('name') : []\"\n                    v-validate=\"'required'\"\n                    :data-vv-as=\"$t('label.name')\"\n                    name=\"name\"\n                    :label=\"$t('label.name') + '*'\"\n                    v-model=\"department.name\"> </v-text-field>\n                  </v-flex>\n                  <!-- value -->\n                  <!-- status -->\n                  <v-flex xs12 sm6 md12>\n                    <label>Trạng thái</label>\n                    <v-checkbox\n                    @change=\"status_txt\"\n                    :label=\"status\"\n                    class=\"checkbox\"\n                    style=\"margin-top:0px\"\n                    name=\"status\"\n                    v-model=\"department.status\">\n                  </v-checkbox>\n                </v-flex>\n                <!--branch_id-->\n                <v-flex xs12>\n                  <label>Tên chi nhánh</label>\n                  <v-autocomplete\n                  v-if=\"Array.isArray(branchAll)\"\n                  :items=\"branchAll\"\n                  item-value=\"id\"\n                  item-text=\"name\"\n                  v-model=\"department.branch_id\"\n                  placeholder=\"Xin vui lòng nhập tên chi nhánh\"\n                  >\n                </v-autocomplete>\n              </v-flex>\n            </v-layout>\n          </v-container>\n        </v-card-text>\n        <v-card-actions>\n          <v-spacer></v-spacer>\n          <v-btn color=\"blue darken-1\" flat @click.native=\"close\">Hủy bỏ</v-btn>\n          <v-btn color=\"blue darken-1\" flat @click.native=\"submitForm\">\n            <span v-if=\"editTitle==-2\">Lưu lại</span><span v-else>Thêm mới</span></v-btn>\n          </v-card-actions>\n        </v-card>\n      </v-dialog>\n    </v-layout>\n    <v-layout slot=\"extension\" v-if=\"!isMini\">\n      <v-flex sm2 class=\"text-bold text-uppercase\">\n        STT\n      </v-flex>\n      <v-flex sm3 class=\"text-bold text-uppercase\">\n        tên phòng ban\n      </v-flex>\n      <v-flex sm3 class=\"text-bold text-uppercase\">\n        tên chi nhánh\n      </v-flex>\n      <v-flex sm2 class=\"text-bold text-uppercase\">\n        trạng thái\n      </v-flex>\n      <v-flex sm2 class=\"text-bold text-uppercase\">\n        hành động\n      </v-flex>\n    </v-layout>\n  </v-toolbar>\n</div>\n<v-flex xs12 class=\"border-e0-top\">\n  <data-view\n  :name=\"dataViewName\"\n  api-url=\"departments\"\n  v-if=\"dataViewHeight\"\n  :viewHeight=\"dataViewHeight\"\n  :params=\"params\"\n  :ref=\"dataViewName\"\n  >\n  <template slot-scope=\"{items}\">\n    <v-list>\n      <template v-for=\"(item, index) in items.data\">\n       <v-layout class=\"pa-2\" :key=\"index\">\n        <v-flex sm2 class=\"ml-3\" sm1 :class=\"isMini && 'd-none'\">\n          {{ index + 1 }}\n        </v-flex>\n        <v-flex sm3 :class=\"isMini && 'd-none'\">\n          {{ item.name }}\n        </v-flex>\n        <v-flex class=\"mr-1\" sm3 :class=\"isMini && 'd-none'\">\n          {{ item.branch_name }}\n        </v-flex>\n        <v-flex sm2 :class=\"isMini && 'd-none'\">\n          {{ item.status_txt }}\n        </v-flex>\n        <v-flex sm2 :class=\"isMini && 'd-none'\">\n          <v-tooltip bottom>\n            <v-btn slot=\"activator\" class=\"ma-0\" v-if=\"canAccess('department.update')\" icon @click=\"editItem(item,item.id)\">\n              <v-icon class='theme--light teal--text'>edit</v-icon>\n            </v-btn>\n            <span>Sửa</span>\n          </v-tooltip>\n          <v-tooltip bottom>\n            <v-btn slot=\"activator\" class=\"ma-0\" v-if=\"canAccess('department.delete')\" icon @click.stop=\"removeConfirm(item.id)\">\n              <v-icon class=\"theme--light pink--text\">delete</v-icon>\n            </v-btn>\n            <span>Xóa</span>\n          </v-tooltip>\n        </v-flex>\n      </v-layout>\n      <v-divider\n      :key=\"'div' + index + item.id\"\n      v-if=\"index + 1 < items.data.length\"\n      ></v-divider>\n    </template>\n  </v-list>\n</template>\n</data-view>\n</v-flex>\n<dialog-confirm v-model=\"dialogDelete\" @input=\"remove\" />\n</v-layout>\n</template>\n<script>\nimport DialogConfirm from '@/components/DialogConfirm'\nimport { debounce } from 'lodash'\nimport DataView from '@/components/DataView/DataView'\nimport { mapActions, mapGetters } from 'vuex'\nexport default{\n  name: 'UserListting',\n  props: {\n    isMini: {\n      type: Boolean,\n      default: false\n    }\n  },\n  components: {\n    DataView,\n    DialogConfirm\n  },\n  data: () => ({\n    dataViewHeight: 0,\n    dataViewName: 'department',\n    idDepartment: null,\n    dialogDelete: false,\n    dialog: false,\n    editedIndex: -1,\n    editTitle: -1,\n    status: 'Không hiển thị',\n    department: {\n      name: '',\n      status: 0,\n      branch_id: ''\n    },\n    params: {\n      q: '',\n      branch_id: ''\n    },\n    defaultItem: {\n    }\n  }),\n  computed: {\n    formTitle () {\n      return this.editTitle === -1 ? 'Thêm phòng ban' : 'Sửa phòng ban'\n    },\n    ...mapGetters('Branch', ['branchAll']),\n    ...mapGetters('Department', ['departmentDetail']),\n    ...mapGetters(['isFetchingApi'])\n  },\n  watch: {\n    dialog (val) {\n      val || this.close()\n    }\n  },\n  methods: {\n    ...mapActions(['setMiniDrawer']),\n    ...mapActions(['showNotify', 'setMiniDrawer']),\n    ...mapActions('Department', ['fetchDepartment', 'createDepartment', 'deleteDepartment', 'updateDepartment']),\n    ...mapActions('Dataview', ['removeDataviewEntry']),\n    ...mapActions('Branch', ['getBranchs']),\n    /// status\n    status_txt () {\n      if (this.department.status) {\n        this.status = 'Hiển thị'\n      } else {\n        this.status = 'Không hiển thị'\n      }\n    },\n    // dialog\n    openDialog () {\n      this.editTitle = -1\n      this.dialog = true\n    },\n    // end dialog\n    close () {\n      this.dialog = false\n      setTimeout(() => {\n        this.department = Object.assign({}, this.defaultItem)\n        this.editedIndex = -1\n      }, 300)\n    },\n    // đổ dữ liệu from edit\n    editItem (item, id) {\n      this.editTitle = -2\n      this.idDepartment = id\n      this.editedIndex = this.departmentDetail.indexOf(item)\n      this.department = Object.assign({}, item)\n      this.dialog = true\n    },\n    submitForm () {\n      if (this.editedIndex === -1) {\n        let department = Object.assign({}, this.department)\n        department.status = department.status ? 1 : 0\n        this.createDepartment({\n          department: department,\n          cb: (response) => {\n            this.dialog = false\n            setTimeout(() => {\n              console.log('data department :', department)\n              this.editedIndex = -1\n            }, 300)\n            this.showNotify({\n              color: 'success',\n              text: 'Thành công'\n            })\n            this.filter()\n          }\n        })\n      } else {\n        let department = Object.assign({}, this.department)\n        department.status = department.status ? 1 : 0\n        this.updateDepartment({\n          id: this.idDepartment,\n          department: department,\n          cb: (response) => {\n            this.fetchDepartment()\n            this.showNotify({\n              color: 'success',\n              text: 'Thành công'\n            })\n            this.dialog = false\n            setTimeout(() => {\n              console.log('data department :', department)\n              this.editedIndex = -1\n            }, 300)\n            this.filter()\n          }\n        })\n      }\n    },\n    /// screach\n    changeSearch: debounce(function () {\n      this.filter()\n    }, 500),\n    filter () {\n      this.$refs[this.dataViewName].$emit('reload')\n    },\n    // xóa department\n    removeConfirm (id) {\n      this.idDepartment = id\n      this.dialogDelete = true\n    },\n    remove (confirm) {\n      if (confirm) {\n        this.deleteDepartment({\n          id: this.idDepartment,\n          cb: (response) => {\n            this.removeDataviewEntry({\n              name: 'department',\n              data: this.departmentDetail,\n              key: 'id'\n            })\n            this.$store.dispatch('showNotify', {\n              text: this.$t('alert.success'),\n              color: 'success'\n            })\n            this.dialogDelete = false\n            this.filter()\n          },\n          error: (error) => {\n            if (error.status === 404) {\n              this.$store.dispatch('showNotify', {\n                text: this.$t('alert.not-found'),\n                color: 'warning'\n              })\n            }\n          }\n        })\n      }\n    }\n  },\n  mounted () {\n    this.dataViewHeight = this.$refs.laylout.clientHeight - 168\n    let query = { ...this.$route.query }\n    if (query.hasOwnProperty('reload')) {\n      this.$nextTick(() => {\n        this.$refs[this.dataViewName].$emit('reload')\n      })\n      delete query.reload\n      this.$router.replace({\n        query: query\n      })\n    }\n  },\n  created () {\n    this.getBranchs()\n    this.fetchDepartment()\n  }\n}\n</script>\n<style scoped>\n  .v-toolbar__extension{\n    height: 66px !important;\n  }\n  .v-input.v-text-field{\n    margin-top: 0px !important;\n  }\n</style>\n"]}]}