{"remainingRequest":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/babel-loader/lib/index.js!/home/nguyenxuancuong/Sites/hrm_fe/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/nguyenxuancuong/Sites/hrm_fe/src/components/DataView/DataView.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/nguyenxuancuong/Sites/hrm_fe/src/components/DataView/DataView.vue","mtime":1538377839382},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/cache-loader/dist/cjs.js","mtime":1534394480737},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/babel-loader/lib/index.js","mtime":1534394476611},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/vue-loader/lib/index.js","mtime":1536410629618}],"contextDependencies":[],"result":["import _toConsumableArray from \"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/@babel/runtime/helpers/builtin/es6/toConsumableArray\";\nimport _objectSpread from \"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/@babel/runtime/helpers/builtin/es6/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport { mapActions, mapGetters } from 'vuex';\nexport default {\n  name: 'DataView',\n  props: {\n    viewHeight: {\n      type: Number,\n      required: true\n    },\n    name: {\n      type: String,\n      required: true\n    },\n    scroll: {\n      type: Object,\n      default: function _default() {\n        return {\n          distance: 200\n        };\n      }\n    },\n    apiUrl: {\n      type: String,\n      required: true\n    },\n    params: {\n      type: Object,\n      default: function _default() {\n        return {};\n      }\n    }\n  },\n  data: function data() {\n    return {};\n  },\n  computed: _objectSpread({}, mapGetters(['isFetchingApi']), {\n    items: function items() {\n      return this.$store.getters['Dataview/dataViews'](this.name);\n    }\n  }),\n  methods: _objectSpread({}, mapActions(['fetchApi']), mapActions('Dataview', ['setDataview', 'initDataview', 'reloadDataview']), {\n    fetchSuccess: function fetchSuccess(response) {\n      this.setDataview({\n        name: this.name,\n        data: _toConsumableArray(this.items.data || []).concat(_toConsumableArray(response.data))\n      });\n\n      if (!!response.meta && !!response.meta.pagination) {\n        this.setDataview({\n          name: this.name,\n          pagination: response.meta.pagination\n        });\n      }\n    },\n    fetchData: function fetchData() {\n      this.fetchApi({\n        url: this.apiUrl,\n        methods: 'GET',\n        params: _objectSpread({}, this.params, {\n          page: this.items && this.items.pagination ? this.items.pagination.current_page : null\n        }),\n        success: this.fetchSuccess\n      });\n    },\n    onScroll: function onScroll(e) {\n      /**\n       * check scroll down & scroll distance bottom <= distance\n       * @author KingDarkness <nguyentranhoan13@gmail.com>\n       */\n      if (this.items.lastScrollPos < e.target.scrollTop && e.target.scrollHeight - (e.target.scrollTop + e.target.offsetHeight) < this.scroll.distance) {\n        if (this.items.pagination.total_pages && !this.isFetchingApi && this.items.pagination.current_page + 1 <= this.items.pagination.total_pages) {\n          var pagination = _objectSpread({}, this.items.pagination);\n\n          ++pagination.current_page;\n          this.setDataview({\n            name: this.name,\n            pagination: pagination\n          });\n          this.fetchData();\n        }\n      }\n\n      this.setDataview({\n        name: this.name,\n        lastScrollPos: e.target.scrollTop\n      });\n    },\n    resetDataView: function resetDataView() {\n      this.reloadDataview({\n        name: this.name\n      });\n      this.fetchData();\n    }\n  }),\n  mounted: function mounted() {\n    var _this = this;\n\n    if (!(this.items && this.items.data && this.items.data.length)) {\n      this.fetchData();\n    }\n\n    this.$nextTick(function () {\n      if (!_this.items.lastScrollPos) {\n        _this.setDataview({\n          name: _this.name,\n          lastScrollPos: 0\n        });\n      } else {\n        _this.$el.scrollTop = _this.items.lastScrollPos;\n      }\n    });\n  },\n  created: function created() {\n    var _this2 = this;\n\n    this.initDataview({\n      name: this.name\n    });\n    this.$on('reload', function () {\n      _this2.resetDataView();\n    });\n  }\n};",{"version":3,"sources":["DataView.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <v-layout id=\"scroll-view\" class=\"scroll-y\" :style=\"{height: viewHeight + 'px'}\" v-scroll:#scroll-view=\"onScroll\" column>\n    <v-flex xs12>\n      <slot :items=\"items\"></slot>\n    </v-flex>\n    <v-flex xs12 v-if=\"isFetchingApi\">\n       <v-progress-linear\n        style=\"margin: 2px 0px 1px 0px\"\n        height=\"3\"\n        color=\"primary\"\n        :indeterminate=\"isFetchingApi\"\n      ></v-progress-linear>\n    </v-flex>\n  </v-layout>\n</template>\n<script>\nimport { mapActions, mapGetters } from 'vuex'\nexport default{\n  name: 'DataView',\n  props: {\n    viewHeight: {\n      type: Number,\n      required: true\n    },\n    name: {\n      type: String,\n      required: true\n    },\n    scroll: {\n      type: Object,\n      default: () => {\n        return {\n          distance: 200\n        }\n      }\n    },\n    apiUrl: {\n      type: String,\n      required: true\n    },\n    params: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    }\n  },\n  data: () => ({\n  }),\n  computed: {\n    ...mapGetters(['isFetchingApi']),\n    items () {\n      return this.$store.getters['Dataview/dataViews'](this.name)\n    }\n  },\n  methods: {\n    ...mapActions(['fetchApi']),\n    ...mapActions('Dataview', ['setDataview', 'initDataview', 'reloadDataview']),\n    fetchSuccess (response) {\n      this.setDataview({ name: this.name, data: [...this.items.data || [], ...response.data] })\n      if (!!response.meta && !!response.meta.pagination) {\n        this.setDataview({ name: this.name, pagination: response.meta.pagination })\n      }\n    },\n    fetchData () {\n      this.fetchApi({\n        url: this.apiUrl,\n        methods: 'GET',\n        params: { ...this.params, page: this.items && this.items.pagination ? this.items.pagination.current_page : null },\n        success: this.fetchSuccess\n      })\n    },\n    onScroll (e) {\n      /**\n       * check scroll down & scroll distance bottom <= distance\n       * @author KingDarkness <nguyentranhoan13@gmail.com>\n       */\n      if (this.items.lastScrollPos < e.target.scrollTop && (e.target.scrollHeight - (e.target.scrollTop + e.target.offsetHeight)) < this.scroll.distance) {\n        if (this.items.pagination.total_pages && !this.isFetchingApi && this.items.pagination.current_page + 1 <= this.items.pagination.total_pages) {\n          let pagination = { ...this.items.pagination }\n          ++pagination.current_page\n          this.setDataview({ name: this.name, pagination: pagination })\n          this.fetchData()\n        }\n      }\n      this.setDataview({ name: this.name, lastScrollPos: e.target.scrollTop })\n    },\n    resetDataView () {\n      this.reloadDataview({ name: this.name })\n      this.fetchData()\n    }\n  },\n  mounted () {\n    if (!(this.items && this.items.data && this.items.data.length)) {\n      this.fetchData()\n    }\n    this.$nextTick(() => {\n      if (!this.items.lastScrollPos) {\n        this.setDataview({ name: this.name, lastScrollPos: 0 })\n      } else {\n        this.$el.scrollTop = this.items.lastScrollPos\n      }\n    })\n  },\n  created () {\n    this.initDataview({ name: this.name })\n    this.$on('reload', () => {\n      this.resetDataView()\n    })\n  }\n}\n</script>\n"],"sourceRoot":"src/components/DataView"}]}