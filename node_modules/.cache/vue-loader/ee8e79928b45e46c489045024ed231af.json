{"remainingRequest":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/nguyenxuancuong/Sites/hrm_fe/src/views/branch/Listting.vue?vue&type=style&index=0&id=443306cf&scoped=true&lang=css&","dependencies":[{"path":"/home/nguyenxuancuong/Sites/hrm_fe/src/views/branch/Listting.vue","mtime":1542943180867},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/postcss-loader/lib/index.js","mtime":499162500000},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/cache-loader/dist/cjs.js","mtime":1538403001796},{"path":"/home/nguyenxuancuong/Sites/hrm_fe/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.v-toolbar__extension{\n  height: 43px;\n}\n#subBranch:hover{\n  caret-color: #f44336 !important;\n  color: #f44336 !important;\n  transition: all 1s 0.5s;\n}\n.copytext{\n  overflow: unset;\n}\n",{"version":3,"sources":["Listting.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6YA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Listting.vue","sourceRoot":"src/views/branch","sourcesContent":["<template>\n  <v-layout ref=\"laylout\" column fill-height>\n   <div ref=\"header\">\n    <v-toolbar height=\"50px\" color=\"white\" flat>\n      <v-layout row wrap>\n        <v-flex xs1 :class=\"isMini && 'full-flex-basic max-width-col-2'\">\n          <v-tooltip bottom>\n            <v-btn slot=\"activator\" v-if=\"canAccess('branch.create')\" class=\"mt-3\" icon color=\"primary\" @click=\"$router.push({name: 'branch-create'})\">\n              <v-icon>add</v-icon>\n            </v-btn>\n            <span>Thêm mới</span>\n          </v-tooltip>\n        </v-flex>\n        <v-flex xs4 class=\"mt-1\" :class=\"isMini && 'full-flex-basic full-width-col-10'\">\n          <v-text-field\n          hide-details\n          single-line\n          placeholder=\"Nhập tên, sđt, email ...\"\n          v-model=\"filterQ\"\n          @keyup=\"changeSearch\"\n          clearable\n          @click:clear=\"changeSearch\"\n          ></v-text-field>\n        </v-flex>\n        <v-flex xs3 class='mt-1' :class=\"isMini && 'd-none'\">\n          <v-autocomplete\n          class='ml-2'\n          @change=\"changedCity\"\n          placeholder=\"Thành phố\"\n          item-text=\"name\"\n          item-value=\"id\"\n          :items=\"cityAll\"\n          v-model=\"filterByCity\"\n          hide-details\n          single-line\n          clearable\n          @click:clear=\"clearCity\"\n          >\n          <template slot=\"no-data\">\n            <v-list-tile>\n              <v-list-tile-title>\n                Không tìm thấy thành phố\n              </v-list-tile-title>\n            </v-list-tile>\n          </template>\n        </v-autocomplete>\n      </v-flex>\n      <v-flex xs3 class='mt-1' :class=\"isMini && 'd-none'\">\n        <v-autocomplete\n        :disabled = \"!filterByCity\"\n        class='ml-2'\n        @change=\"filter\"\n        placeholder=\"Quận huyện\"\n        item-text=\"name\"\n        item-value=\"id\"\n        :items=\"districtByCity\"\n        v-model=\"filterByDistrict\"\n        menu-props=\"auto\"\n        hide-details\n        single-line\n        clearable\n        >\n        <template slot=\"no-data\">\n          <v-list-tile>\n            <v-list-tile-title>\n              Không tìm thấy quân huyện\n            </v-list-tile-title>\n          </v-list-tile>\n        </template>\n      </v-autocomplete>\n    </v-flex>\n    <v-flex xs1 :class=\"isMini && 'd-none'\">\n      <v-tooltip bottom>\n        <v-btn class=\"mt-3 ml-4\" slot=\"activator\" icon color=\"primary\" @click=\"resetForm()\">\n          <v-icon>close</v-icon>\n        </v-btn>\n        <span>Reset bộ lọc</span>\n      </v-tooltip>\n    </v-flex>\n  </v-layout>\n  <v-layout slot=\"extension\" v-if=\"!isMini\">\n    <v-flex style=\"flex-basis:55px;\" sm1 class=\"text-bold\">\n      #\n    </v-flex>\n    <v-flex sm3 class=\"text-bold\">\n      Tên chi nhánh\n    </v-flex>\n    <v-flex sm3 class=\"text-bold\">\n      Địa chỉ\n    </v-flex>\n    <v-flex sm2 class=\"text-bold\">\n      Thành phố\n    </v-flex>\n    <v-flex sm2 class=\"text-bold\">\n      Quận, huyện\n    </v-flex>\n    <v-flex sm1 class=\"text-bold mr-3\">\n      Hành động\n    </v-flex>\n  </v-layout>\n</v-toolbar>\n</div>\n<v-flex xs12 class=\"border-e0-top\">\n  <data-view\n  :name=\"dataViewName\"\n  api-url=\"branches?sort=status:-1,id:-1\"\n  v-if=\"dataViewHeight\"\n  :viewHeight=\"dataViewHeight\"\n  :params=\"filterParams\"\n  :ref=\"dataViewName\"\n  >\n  <template slot-scope=\"{items}\">\n    <v-list three-line>\n      <template v-for=\"(item, index) in items.data\">\n        <v-list-tile\n        :key=\"'item' + item.id\"\n        avatar\n        @click=\"branchDetail(item)\"\n        :inactive=\"item.id === $route.params.id\"\n        :class=\"item.id === $route.params.id && 'grey lighten-2'\"\n        >\n        <v-layout class=\"pa-2\">\n          <v-flex style=\"flex-basis:55px;\" sm1 :class=\"isMini && 'd-none'\">\n            {{index + 1}}\n          </v-flex>\n          <v-flex sm3 :class=\"isMini && 'full-flex-basic full-max-width'\">\n            {{ item.name}}\n            <v-tooltip bottom v-if=\"item.type===1\">\n              <v-icon @click.stop class=\"mb-1\" size=\"15px\" slot=\"activator\" color=\"red\">fa fa-star</v-icon>\n              <span>Chi nhánh chính</span>\n            </v-tooltip>\n            <v-icon v-else id=\"subBranch\" @click.stop=\"updatedTypeBranch(item)\" class=\"mb-1\" size=\"15px\" slot=\"activator\" color=\"red lighten-4\">fa fa-star</v-icon>\n            <v-list-tile-sub-title class=\"text--primary copytext\" v-if=\"item.email\" :class=\"isMini && 'd-none'\">\n              <v-icon size=\"16px\">email</v-icon>\n              <span @click.stop=\"clickToCopy\" class=\"click-copy\">{{ item.email }}</span>\n            </v-list-tile-sub-title>\n            <v-list-tile-sub-title class=\"text--primary copytext\" v-if=\"item.phone\" :class=\"isMini && 'd-none'\">\n              <v-icon size=\"16px\">phone</v-icon>\n              <span @click.stop=\"clickToCopy\" class=\"click-copy\">{{ item.phone }}</span>\n            </v-list-tile-sub-title>\n          </v-flex>\n          <v-flex sm3 class=\"ml-1 pr-3\" :class=\"isMini && 'd-none'\">\n            {{ item.address }}\n          </v-flex>\n          <v-flex sm2 class='ml-2' :class=\"isMini && 'd-none'\">\n            {{ item.city_name }}\n          </v-flex>\n          <v-flex sm2 :class=\"isMini && 'd-none'\">\n            {{ item.district_name }}\n          </v-flex>\n          <v-flex sm1 :class=\"isMini && 'd-none'\">\n            <v-tooltip bottom sm6>\n              <v-btn slot=\"activator\" class=\"ma-0\" v-if=\"canAccess('branch.update')\" icon @click.stop=\"$router.push({name: 'branch-edit', params: {id: item.id}})\">\n                <v-icon class='theme--light teal--text'>edit</v-icon>\n              </v-btn>\n              <span>Sửa</span>\n            </v-tooltip>\n            <v-tooltip bottom sm6>\n              <v-btn slot=\"activator\" class=\"ma-0\" v-if=\"canAccess('branch.delete')\" icon @click.stop=\"removeConfirm(item)\">\n                <v-icon class=\"theme--light pink--text\">delete</v-icon>\n              </v-btn>\n              <span>Xóa</span>\n            </v-tooltip>\n            <v-tooltip bottom sm12>\n              <v-switch\n              @click.native.stop\n              @change=\"changeStatus(item.id)\"\n              class='ml-3'\n              name=\"status\"\n              slot=\"activator\"\n              v-model=\"item.status\"\n              ></v-switch>\n              <span v-if=\"item.status\">Hoạt Động</span>\n              <span v-else>Không hoạt động</span>\n            </v-tooltip>\n          </v-flex>\n        </v-layout>\n      </v-list-tile>\n      <v-divider\n      :key=\"'div' + index + item.id\"\n      v-if=\"index + 1 < items.data.length\"\n      ></v-divider>\n    </template>\n  </v-list>\n  <dialog-confirm v-model=\"dialogDelete\" @input=\"remove\" />\n</template>\n</data-view>\n</v-flex>\n</v-layout>\n</template>\n<script>\nimport { mapFields } from 'vuex-map-fields'\nimport { debounce, findIndex } from 'lodash'\nimport DialogConfirm from '@/components/DialogConfirm'\nimport DataView from '@/components/DataView/DataView'\nimport { mapActions, mapGetters } from 'vuex'\nexport default {\n  name: 'BranchListting',\n  components: {\n    DataView,\n    DialogConfirm\n  },\n  props: {\n    type: {\n      type: String,\n      default: 'index'\n    },\n    isMini: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data: () => ({\n    branch: {\n      status: 1,\n      type: 1\n    },\n    districtActive: false,\n    dialogDelete: false,\n    item: {},\n    idBranch: null,\n    title: [\n      { text: 'Tên chi nhánh', sortable: false },\n      { text: 'Email', sortable: false },\n      { text: 'Mã sô thuế', sortable: false },\n      { text: 'Địa chỉ', sortable: false },\n      { text: 'Trạng thái', sortable: false },\n      { text: 'Hành động', sortable: false }\n    ],\n    dataViewHeight: 0,\n    dataViewName: 'branch'\n  }),\n  computed: {\n    ...mapGetters('City', ['cityAll', 'districtByCity']),\n    ...mapGetters('Branch', ['filterParams']),\n    isIndex () {\n      return this.type === 'index'\n    },\n    isBranchMain () {\n      let array = this.$store.getters['Dataview/dataViews']('branch')\n      return array.data\n    },\n    ...mapFields(`Branch`, {\n      filterQ: 'params.q',\n      filterByCity: 'params.cityId',\n      filterByDistrict: 'params.districtId'\n    })\n  },\n  methods: {\n    ...mapActions(['setMiniDrawer']),\n    ...mapActions('Dataview', ['removeDataviewEntry', 'updateDataviewEntry']),\n    ...mapActions('Branch', ['getBranch', 'updateTypeBranch', 'deleteBranch', 'updateStatusBranch', 'clearFilter', 'clearFilterCity']),\n    ...mapActions(['showNotify', 'setMiniDrawer']),\n    ...mapActions('City', ['getCity', 'getDistrictByCity']),\n    branchDetail (branch) {\n      this.clearFilter()\n      this.filter()\n      this.getBranch({ branchId: branch.id })\n      // this.clearFilter()\n      this.$router.push({ name: 'branch-detail', params: { id: branch.id } })\n    },\n    clearCity () {\n      this.clearFilterCity()\n    },\n    resetForm () {\n      this.clearFilter()\n    },\n    changeSearch: debounce(function () {\n      this.filter()\n    }, 500),\n    changedCity: debounce(function (value) {\n      if (value) {\n        this.districtActive = true\n        this.getDistrictByCity({\n          cityId: value,\n          cb: () => {\n            this.districtAll = this.districtByCity\n          }\n        })\n      } else {\n        this.districtActive = false\n      }\n      this.filter()\n    }, 500),\n    filter () {\n      this.$refs[this.dataViewName].$emit('reload')\n    },\n    updatedTypeBranch (item) {\n      this.updateTypeBranch({\n        id: item.id,\n        cb: (response) => {\n          this.$store.dispatch('showNotify', {\n            text: this.$t('alert.updateTypeBranchSuccess'),\n            color: 'success'\n          })\n          // tìm trong mảng vị trí index có kiểu chi nhánh chính\n          let index = findIndex(this.isBranchMain, { type: 1 })\n          if (index > -1) {\n            let object = Object.assign({}, this.isBranchMain[index])\n            object.type = 0\n            this.updateDataviewEntry({\n              name: 'branch',\n              data: object,\n              key: 'id'\n            })\n          }\n          this.updateDataviewEntry({\n            name: 'branch',\n            data: response.data,\n            key: 'id'\n          })\n        },\n        error: (error) => {\n          if (error.status === 404) {\n            this.$store.dispatch('showNotify', {\n              text: this.$t('alert.not-found'),\n              color: 'warning'\n            })\n          }\n        }\n      })\n    },\n    changeStatus (idBranch) {\n      this.updateStatusBranch({\n        id: idBranch,\n        cb: (response) => {\n          this.$store.dispatch('showNotify', {\n            text: this.$t('alert.statusSuccess'),\n            color: 'success'\n          })\n        },\n        error: (error) => {\n          if (error.status === 404) {\n            this.$store.dispatch('showNotify', {\n              text: this.$t('alert.not-found'),\n              color: 'warning'\n            })\n          }\n        }\n      })\n    },\n    removeConfirm (item) {\n      this.branch = item\n      this.idBranch = item.id\n      this.dialogDelete = true\n    },\n    remove (confirm) {\n      if (confirm) {\n        this.deleteBranch({\n          id: this.idBranch,\n          cb: (response) => {\n            this.$store.dispatch('showNotify', {\n              text: this.$t('alert.deleteBranchSuccess'),\n              color: 'success'\n            })\n            this.removeDataviewEntry({\n              name: 'branch',\n              data: this.branch,\n              key: 'id'\n            })\n            this.dialogDelete = false\n          },\n          error: (error) => {\n            if (error.status === 404) {\n              this.$store.dispatch('showNotify', {\n                text: this.$t('alert.not-found'),\n                color: 'warning'\n              })\n            }\n          }\n        })\n      }\n    }\n  },\n  mounted () {\n    if (this.$route.params.id) {\n      this.dataViewHeight = this.$refs.laylout.clientHeight - 48\n    } else {\n      this.dataViewHeight = this.$refs.laylout.clientHeight - 110\n    }\n    let query = { ...this.$route.query }\n    if (query.hasOwnProperty('reload')) {\n      this.$nextTick(() => {\n        this.$refs[this.dataViewName].$emit('reload')\n      })\n      delete query.reload\n      this.$router.replace({\n        query: query\n      })\n    }\n  },\n  created () {\n    this.getCity()\n  }\n}\n</script>\n<style scoped>\n.v-toolbar__extension{\n  height: 43px;\n}\n#subBranch:hover{\n  caret-color: #f44336 !important;\n  color: #f44336 !important;\n  transition: all 1s 0.5s;\n}\n.copytext{\n  overflow: unset;\n}\n</style>\n"]}]}